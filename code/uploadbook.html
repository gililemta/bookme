<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Upload Book</title>

</head>
<header>
    <h1>BookMe</h1>
</header>
<body>
    <div id="pageData">
    <h2>
        העלאת ספר
    </h2>
    <form action="/submit" method="post" enctype="multipart/form-data">
        <h3>
            פרטי ספר
        </h3>

        <div class="bookName">
        <label for="bookName">שם הספר:</label>
        <input type="text" id="field" name="bookName" required>
        </div>

        <div class="authorName">
        <label for="authorName" > שם הסופר/ת: </label>
        <input type="text" id="field" name="authorName" required>
        </div>

        <div class="genreName">
        <label for="genreName">ז׳אנר:</label></label>
        <select id="genre" name="genre">
            <option value="genre1">רומן</option>
            <option value="genre2">מדע בדיוני</option>
            <option value="genre3">קומיקס</option>
            <option value="genre4">היסטוריה</option>
            <option value="genre5">מסתורין</option>
            <option value="genre6">ביוגרפיה</option>
            <option value="genre7">ילדים</option>
            <option value="genre8">פנטזיה</option>
            <option value="genre9">שירה</option>
            <option value="genre10">אחר</option>
        </select>
    </div>

        <!-- Picture Upload -->
        <div class="file-input-container">
        <label for="bookPicture">העלאת תמונה: </label></label>
        <label for="bookPicture" class="file-input-label" id="fileInputLabel">בחר קובץ</label>
        <input type="file" id="bookPicture" name="bookPicture" accept="image/*" onchange="updateLabel()">
        </div>

        <!-- Success Message -->
        <div id="uploadSuccessMessage"></div>

        <!-- Uploaded Image -->
        <img id="uploadedImage" alt="Uploaded Image">

        <h3>
            פרטי העסקה
        </h3>      

        <div class="dealType">
            <label for="dealType">אני מעוניין</label>
            <select id="dealType" name="dealType" onchange="togglePriceField()">
                <option value="deal1">להחליף</option>
                <option value="deal2">למכור</option>
            </select>
        </div>

        <div id="priceField" style="display: none;">
            <label for="price">מחיר:</label>
            <input type="text" id="price" name="price">
        </div>


        <!-- need to find a way to autocomplete cities here --> 
        <div class="city">
            <label for="city">אני נמצא בעיר</label>
            <select id="city" name="city"></select>
        </div>

        <!-- Submit Button -->
        <input type="submit" value="הוסף פריט">
    </form>
</div>










<!-- move this to a seperate file  -->
    <script>
        // JavaScript function to update label text and show success message and uploaded image
        function updateLabel() {
            var label = document.getElementById("fileInputLabel");
            label.textContent = "הקובץ הועלה בהצלחה";
            label.style.backgroundColor = "green";
            
            // Display success message
            var successMessage = document.getElementById("uploadSuccessMessage");
            successMessage.textContent = "התמונה הועלתה בהצלחה!";

            // Display uploaded image
            var uploadedImage = document.getElementById("uploadedImage");
            uploadedImage.src = URL.createObjectURL(document.getElementById("bookPicture").files[0]);
            uploadedImage.style.display = "block";
        }

        // JavaScript function to toggle the price field based on the selected dealType
        function togglePriceField() {
            var dealType = document.getElementById("dealType").value;
            var priceField = document.getElementById("priceField");

            if (dealType === "deal2") {
                priceField.style.display = "inline";
            } else {
                priceField.style.display = "none";
            }}


            // fetch cities
// Fetch cities from Geonames API using a CORS proxy
const username = 'gilile';
        const apiUrl = `https://cors-anywhere.herokuapp.com/http://api.geonames.org/searchJSON?country=IL&featureClass=P&username=${gilile}`;

        const citySelect = document.getElementById('city');

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                // Extract city names from the data
                const cities = data.geonames.map(city => city.name);
                
                // Populate the dropdown with city names
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching cities:', error));
    </script>

</body>
</html>